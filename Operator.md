# GToken 销售合约操作手册

本文档旨在从产品和运营的视角，解释 GToken 销售智能合约的工作原理，并为社区负责人和技术团队提供清晰的操作指引。

可以将此合约想象成一台为 GToken 发售活动专门设计的 **“智能自动售货机”**。

---

## 一、面向社区负责人 (Staff) 的产品说明

### 1. 合约逻辑 (售货机如何工作)

1.  **只卖一种商品**: 机器里只卖 GToken。
2.  **限量供应**: 我们会提前向机器里“备货”，放入固定的 105 万枚 GToken。它自己不能生产新的 GToken，卖完即止。
3.  **动态调价 (越早买越划算)**: 价格会随着销量自动上涨，分为三个“加速”阶段：
    *   **“早鸟阶段”**: 前 21 万枚，价格从 $1.0 缓慢涨到 $1.5。这是给最核心支持者的福利。
    *   **“增长阶段”**: 中间 42 万枚，价格上涨加速，从 $1.5 涨到 $2.5。
    *   **“冲刺阶段”**: 最后 42 万枚，价格上涨最快，从 $2.5 冲向约 $3.0 的封顶价。
4.  **VIP 专供 (白名单机制)**: 这不是一台谁都能用的售货机。它门口站着一个“智能保镖”（链下验证服务）。只有在您提供的“VIP 客户名单”上的人，才能获得“数字门票”（一个特殊的签名），“保镖”验票后才允许购买。
5.  **严格的限购规则**: “保镖”还会执行两个规则：
    *   **每人限购一次**。
    *   **遵守个人额度**（例如，某地址最多只能买 $3000）。
6.  **支持多种货币**: 客户可以使用 USDC, USDT, ETH, WBTC 等主流货币支付。
7.  **资金自动入库**: 所有销售收入都会被直接、安全地转入 DAO 的“金库”（Treasury 多签钱包），全程在区块链上公开透明。

### 2. 您需要准备什么？

您的工作主要在“链下”，即合约部署前的准备和部署后的运营。

**准备阶段 (Checklist):**

1.  **✅ 确定“VIP客户名单” (白名单)**: 最重要的准备工作。整理一份表格，包含：
    *   `参与者的以太坊地址`
    *   `该地址对应的最高购买额度 (以美元计)`
2.  **✅ 确定“金库”地址 (Treasury)**: 提供一个最终收款用的、绝对安全的多签钱包地址。
3.  **✅ 确定“管理员”地址 (Owner)**: 提供一个用于管理合约的、绝对安全的多签钱包地址。
4.  **✅ 准备社区宣传材料**: 撰写清晰的公告、教程、FAQ，向社区解释销售规则和操作步骤。

### 3. 如何使用/监控合约？

*   **您的角色**: 社区沟通和用户支持。合约一旦启动，销售过程是全自动的。
*   **如何监控**: 您可以通过区块链浏览器（如 Etherscan）实时监控销售进展。技术人员会提供给您一个专属的合约地址链接。通过链接，您可以看到：
    *   当前已售出多少 GToken (`tokensSold`)。
    *   当前的实时价格 (`getCurrentPriceUSD`)。
    *   每一笔成功的购买记录。
*   **问题支持**: 当社区成员遇到问题时（例如“为什么我买不了？”），您需要充当第一响应人。您可以先根据白名单核对他的资格，如果信息无误，再将问题同步给技术人员排查。

---

## 二、面向技术团队 (Dev) 的操作手册

### 第一阶段：预部署

1.  **完成合约代码**:
    *   在 `buyTokens` 函数中，完成 `TODO` 标记的 **EIP-712 签名验证**逻辑。
    *   在 `buyTokens` 函数中，完成 `TODO` 标记的**多币种支付**逻辑，需集成 Chainlink 预言机来换算 ETH/WBTC 的美元价值。
2.  **部署链下验证服务**:
    *   根据产品提供的白名单（地址-额度），部署一个可以为合格用户请求签发 EIP-712 签名的后端服务。
3.  **最终测试网演练**:
    *   将**合约**和**验证服务**完整部署到 Sepolia 等公开测试网。
    *   邀请核心社区成员，使用测试币进行一次端到端的完整购买流程演练。

### 第二阶段：主网部署日

1.  **获取最终地址**: 从核心团队获取最终的、用于主网的**金库 (Treasury) 地址**和**管理员 (Owner) 地址**。
2.  **部署合约**:
    *   运行 `forge script script/DeploySaleContract.s.sol --rpc-url [主网RPC] --broadcast --verify` 命令部署合约。
3.  **配置合约**:
    *   部署成功后，立即由 **Owner** 地址调用 `setWhitelistVerifier()` 函数，将合约与链下验证服务的签名地址关联起来。
4.  **为合约“备货” (关键步骤!)**:
    *   从 DAO 的代币持有地址，向新部署的 `SaleContract` 合约地址**转入 1,050,000 枚 GToken**。**此步骤完成前，任何销售都无法进行。**
5.  **公开合约**:
    *   在 Etherscan 上确认合约已开源验证。将合约地址分享给社区和运营团队用于监控。

### 第三阶段：销售结束后

1.  **回收未售出代币**: 如果销售期结束但仍有代币剩余，由 **Owner** 地址调用 `withdrawUnsoldTokens()` 函数，将剩余代币转回金库。
2.  **按计划提供流动性**: 使用募集到的部分资金和对应比例的 GToken，在 Uniswap 等 DEX 上建立初始流动性池。
