# Custom Sale Contract 开发计划

## 项目概述

基于Solution.md和Solution2.md的技术分析，本项目将打造一个现代化的Token销售平台，结合DeFi和GameFi元素，实现社区驱动的公平启动。

### 核心目标
- **总量控制**: 2100万代币，只销售20%（420万代币）
- **公平机制**: 白名单验证 + 分阶段价格机制
- **游戏化**: 购买代币获得游戏通行证，玩游戏可增量获得代币
- **去中心化治理**: 基于OpenZeppelin Governor
- **Launchpad扩展性**: 为未来生态项目提供销售模板

### 当前状态
- ✅ 已放弃Juicebox，专注于自定义开发
- ✅ 已有基础SaleContract.sol (阶段性价格销售)
- ✅ Foundry开发环境配置完成
- ✅ 完整的测试覆盖 (24/24测试通过)

---

## Phase 1: 基础设施建设 (0.3.x) - 2-3周

### 🎯 目标
建立现代化的技术栈，实现基础的代币销售功能，为后续功能扩展奠定基础。

### 📋 任务清单

#### 1.1 治理代币合约 (GovernanceToken.sol) - 3天
**现状**: 无独立的治理代币合约
**目标**: 创建符合ERC20Votes标准的治理代币，使用OpenZeppelin Governor + ERC20Votes
**技术栈**: OpenZeppelin Contracts v5.x（最新是5.x么？）

```solidity
// 核心功能:
- ERC20基础功能
- ERC20Permit (无Gas签名)
- ERC20Votes (治理投票)
- 总量控制: 21,000,000
- 一次性铸造给销售合约，进行初始化分配：销售合约获得20%（获得初始化资金和fair launch），HyperCapital公司获得20%（获得商业投资和商业绑定），社区国库获得60%（为使用者和生态贡献者提供规则分配）
- 合约参考 SuperPaymaster repo的GToken和GTokenStaking合约，是Governance Token的未来使用场景之一。https://vscode.dev/github/AAStarCommunity/SuperPaymaster/blob/stable-v2/contracts/src/paymasters/v3/core/GTokenStaking.sol，  https://vscode.dev/github/AAStarCommunity/SuperPaymaster/blob/stable-v2/contracts/src/paymasters/v3/interfaces/IGTokenStakingV3.sol，https://vscode.dev/github/AAStarCommunity/SuperPaymaster/blob/stable-v2/contracts/src/paymasters/v3/core/GTokenStaking.sol
```

**验收标准**:
- [x] 合约编译通过
- [x] 基础转账功能正常
- [x] 投票功能测试通过
- [x] 单元测试覆盖率 >95% (10/10 tests passing)

#### 1.2 升级SaleContract架构 - 5天
**现状**: 现有的SaleContract.sol比较基础
**目标**: 基于Thirdweb Drop逻辑重构销售合约，尽力以ThirdWeb为基础，少改动，模块化改动，保障安全和极端情况安全。
**技术栈**: 参考Thirdweb DropERC20 + OpenZeppelin


**核心改进**:
```solidity
// 新增功能:
- ClaimConditions结构体 (多阶段销售)
- 白名单验证 (Merkle Proof)
- 分阶段价格机制 (支持阶梯价和基础Bonding Curve)
- 个人购买上限
- 代币总量控制 (420万销售上限)
- 资金直接进入Gnosis Safe多签
```

**验收标准**:
- [ ] 支持多销售阶段配置
- [ ] 白名单Merkle验证
- [ ] 价格自动调整机制
- [ ] 购买上限控制
- [ ] 所有原有测试仍通过

#### 1.3 集成Sablier V2 (代币释放) - 4天
**现状**: 无代币释放机制
**目标**: 实现基于Sablier的代币线性释放
**技术栈**: Sablier V2 Lockup Linear

**核心功能**:
```solidity
// 实现逻辑:
- 用户购买时不直接获得代币
- 创建Sablier Stream NFT (代表未来代币领取权)
- 支持转让的NFT (可在OpenSea交易)
- 线性释放: 365天持续释放
- 游戏通行证功能
```

**验收标准**:
- [ ] Sablier集成测试通过
- [ ] NFT正确生成和转让
- [ ] 代币线性释放验证
- [ ] 游戏通行证基础功能

#### 1.4 完整的测试套件 - 3天
**现状**: 已有基础测试
**目标**: 完整的集成测试和安全测试
**技术栈**: Foundry测试框架

**测试覆盖**:
- [ ] 单元测试 (所有合约函数)
- [ ] 集成测试 (完整购买流程)
- [ ] 安全测试 (边界条件、拒绝服务等)
- [ ] Gas优化测试
- [ ] Fuzz测试 (关键函数)

**验收标准**:
- [ ] 测试覆盖率 >95%
- [ ] 所有测试通过
- [ ] CI/CD流水线配置完成

#### 1.5 部署脚本和配置 - 2天
**现状**: 无正式部署脚本
**目标**: 多网络部署支持
**技术栈**: Foundry脚本

**部署目标**:
- [ ] Sepolia测试网部署
- [ ] 部署验证脚本
- [ ] 环境配置文档
- [ ] 部署后的验证检查

### 📅 Phase 1 时间表
- **总时长**: 17个工作日
- **每周目标**:
  - Week 1: 治理代币 + SaleContract升级
  - Week 2: Sablier集成 + 测试完善
  - Week 3: 部署脚本 + 文档完善

### 🎯 Phase 1 里程碑
- [ ] 所有合约编译通过
- [ ] 基础销售功能完整 (白名单验证 + 分阶段价格)
- [ ] Sablier释放机制工作正常
- [ ] 测试覆盖率 >95%
- [ ] 可在Sepolia测试网部署
- [ ] **版本发布**: v0.3.0 - 核心销售功能完成

---

## Phase 2: 游戏化功能 (0.4.x) - 3-4周

### 🎯 目标
实现游戏化元素，让代币销售不仅仅是金融产品，更是游戏通行证。

### 📋 任务清单

#### 2.1 游戏合约架构设计 - 3天
**核心组件**:
```solidity
// GameContract.sol
- 玩家注册 (验证Sablier NFT持有)
- 等级系统设计
- 成就系统框架
- 奖励池管理
```

#### 2.2 增量代币奖励机制 - 5天
**实现方案**: 主流(Sablier) + 奖励流(Game Contract)
```solidity
// 奖励机制:
- 等级升级奖励 (一次性或新流)
- 成就解锁奖励
- 社区贡献奖励
- 动态释放速度调整
```

#### 2.3 游戏状态管理 - 4天
```solidity
// 状态变量:
- 玩家等级和经验
- 成就进度
- 奖励领取状态
- NFT质押状态
```

#### 2.4 前端界面原型 - 5天
**技术栈**: Next.js + TypeScript + Tailwind CSS
```typescript
// 核心页面:
- 销售页面 (支持游戏通行证选项)
- 个人仪表板 (显示vesting状态)
- 游戏界面 (等级、成就、奖励)
- 治理页面 (投票功能)
```

#### 2.5 集成测试 - 3天
- [ ] 完整游戏化流程测试
- [ ] 前后端集成测试
- [ ] 用户体验测试

### 📅 Phase 2 时间表
- **总时长**: 20个工作日

### 🎯 Phase 2 里程碑
- [ ] 游戏化销售流程完整
- [ ] 基础前端界面可用
- [ ] 增量奖励机制工作正常
- [ ] **版本发布**: v0.4.0 - 游戏化功能完成

---

## Phase 3: Launchpad扩展 (0.5.x) - 4-5周

### 🎯 目标
将单一代币销售平台扩展为支持多项目的Launchpad。

### 📋 任务清单

#### 3.1 工厂合约设计 - 5天
**Factory Pattern实现**:
```solidity
// LaunchpadFactory.sol
- 销售模板注册
- 克隆部署 (EIP-1167)
- 模板升级机制
- 费用收集 (1%手续费)
```

#### 3.2 多项目管理 - 4天
```solidity
// 管理功能:
- 项目注册和审核
- 统计数据收集
- 收益分配机制
```

#### 3.3 治理合约集成 - 5天
**基于OpenZeppelin Governor**:
```solidity
// Governance.sol
- 提案创建 (新项目审核)
- 投票机制
- 执行机制
- 时间锁控制
```

#### 3.4 高级前端功能 - 7天
```typescript
// Launchpad界面:
- 项目发现页面
- 项目创建流程
- 治理投票界面
- 统计数据可视化
```

#### 3.5 生产部署准备 - 4天
- [ ] 多链部署支持
- [ ] 监控和告警
- [ ] 安全审计准备
- [ ] 文档完善

### 📅 Phase 3 时间表
- **总时长**: 25个工作日

### 🎯 Phase 3 里程碑
- [ ] Launchpad基础功能完成
- [ ] 治理系统上线
- [ ] 多项目支持
- [ ] **版本发布**: v0.5.0 - Launchpad MVP完成

---

## Phase 4: 生产就绪和生态建设 (1.0.x) - 6-8周

### 🎯 目标
打造生产级别的平台，支持大规模使用。

### 📋 关键任务
- [ ] 安全审计和修复
- [ ] 性能优化和Gas优化
- [ ] 多链部署 (Ethereum, Base, Arbitrum)
- [ ] 完整的文档和SDK
- [ ] 社区运营工具
- [ ] 流动性管理和Uniswap集成

---

## 风险评估和应对策略

### 技术风险
1. **Sablier集成复杂度**
   - **应对**: 分阶段实现，先验证基本功能
   - **备选**: 如果Sablier过于复杂，可考虑简化版本

2. **Gas费用优化**
   - **应对**: 持续进行Gas优化测试
   - **目标**: 保持在合理范围内

### 业务风险
1. **用户接受度**
   - **应对**: 设计良好的用户体验
   - **验证**: 进行用户测试和反馈收集

2. **市场竞争**
   - **应对**: 专注于游戏化特色
   - **优势**: 独特的Play-to-Earn机制

### 安全风险
1. **智能合约安全**
   - **应对**: 专业安全审计
   - **时间**: 在Phase 3末尾安排

2. **资金安全**
   - **应对**: Gnosis Safe多签 + 时间锁
   - **验证**: 定期安全检查

---

## 开发原则

### 🔄 迭代开发
- **小步快跑**: 每个功能都经过完整测试后才进入下一阶段
- **用户反馈**: 在关键节点收集用户反馈
- **灵活调整**: 根据实际情况调整计划

### 🧪 测试驱动
- **测试先行**: 新功能先写测试，再实现代码
- **持续集成**: 每次提交都运行完整测试套件
- **自动化**: 建立CI/CD流水线

### 📊 数据驱动
- **关键指标**: 关注用户参与度、Gas费用、安全事件
- **监控告警**: 建立完整的监控体系
- **持续优化**: 基于数据持续改进

---

## 资源需求

### 开发团队
- **核心开发者**: 2-3人 (Solidity + Frontend)
- **设计师**: 1人 (UI/UX)
- **测试工程师**: 1人 (质量保证)

### 外部资源
- **安全审计**: Phase 3安排 (预估成本: $10k-20k)
- **法律咨询**: 合规性审查
- **社区运营**: Discord/Telegram管理

---

## 成功指标

### Phase 1 (0.3.x)
- [ ] 代币销售功能完整无Bug
- [ ] 测试覆盖率 >95%
- [ ] Gas费用在合理范围内

### Phase 2 (0.4.x)
- [ ] 用户成功完成游戏化购买流程
- [ ] 前端界面响应良好
- [ ] 奖励机制激励用户参与

### Phase 3 (0.5.x)
- [ ] 至少3个外部项目使用Launchpad
- [ ] 治理投票活跃度 >20%
- [ ] 平台日活跃用户 >100

### Phase 4 (1.0.x)
- [ ] 总锁仓价值 >$100k
- [ ] 社区治理提案通过率 >50%
- [ ] 平台稳定运行 >6个月

---

*此开发计划基于Solution.md和Solution2.md的技术分析，采用渐进式迭代方法，确保每个阶段都有明确可交付成果。*
